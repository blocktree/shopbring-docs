# 代购交易模块设计

## 概述

消费者发布一笔代购交易单，并锁定与购物车等额的加密货币，并提供小费作为报酬。代购者接受交易，完成代购过程，最终获得锁定中的加密货币和小费。

## 业务流程

### 角色

- **消费者**。发布代购交易单，使用加密货币作为支付方式，并提供小费作为报酬。
- **代购者**。接受代购交易单，在电商平台完成实际商品买卖，让商家把商品发货给真实消费者。

1. 消费者请求代购交易，等待代购者接单。此阶段消费者也可以手动关闭订单。提交关键参数：商品链接，发起者地址，支付币种，支付金额，小费金额，要求信用值（非必填），要求保证金额（非必填），收货地区（国家，省/州，市）。
2. 代购者响应代购交易，等待消费者提交收货人信息。提交关键参数：平台账户名（加密），代购者地址（加密），保证金额。
3. 消费者提交收货人信息，等待代购者购买商品。提交关键参数：收货地址（加密），收货人名（加密），联系电话（加密），社交账号（加密）。
4. 代购者确认商家发货。提交关键参数：商家订单号（加密），物流运单（加密）
5. 消费者确认收货或申请退换货。
    5.1 消费确认收货，代购交易完成。
    5.2 消费申请退换货，提交关键参数：类型（退货/换货）（加密），退换货原因（加密）。
    5.3 代购者联系商家解决退换货，提交退换货地址信息，关键参数：是否接受（是/否），退货地址（加密），退货联系人（加密），退货联系电话（加密），不接受退换货原因（加密）。
    5.4 消费者执行退换货，提交关键参数：运单号（加密）。
    5.5 商家确认收到货后，代购者确认退换货成功。类别为退货的话，会退回冻结的支付金额给消费者，小费则支付给代购者。
6. 交易完结后，消费者或代购者提交发票信息。提交关键参数：发票代码，发票号码，开票日期，发票金额，发票后6位验证码。
7. 系统在链下验证发票真伪。对已完成的代购交易单中的发票信息进行验证，通过才会增加双方信用值。

> 注意：消费者与代购者在请求响应代购交易过程中会完成协商密码，在后面的步骤中对隐私信息进行加密。

每个阶段都有操作时限，如果超时，有以下处理情况：

- 当没有任何代购者响应代购交易单而超时，订单自动关闭，锁定的支付金额和小费退回消费者。
- 当消费者超过了提交收货人信息的限制时间，订单自动关闭，订单小费支付给代购者。
- 当代购者超过了确认商家已发货的限制时间，订单自动关闭，代购者的保证金支付给消费者，锁定的支付金额和小费退回消费者。
- 当消费者超过了确认收货的限制时间，订单自动完成，支付金额和小费转给代购者。
- 当消费者申请退货，但代购者超过了提交退货地址的限制时间，订单自动关闭，代购者的保证金支付给消费者，锁定的支付金额和小费退回消费者。
- 当消费者超过了提交退货运单的限制时间，订单自动完成，支付金额和小费转给代购者。
- 当代购者超过验收退货的限制时间，订单自动完成。类型为退货支付金额退回消费者，小费转给代购者；类型为换货，支付金额和小费转给代购者。

## 数据模型

### 常量

### 成员变量

### 存储表

### 枚举

### 结构体

| Parameter    | Type    | Description      |
|--------------|---------|------------------|

## 公共方法


## 错误码

- `InsufficientBalance`。账户余额不足。
- `InvitationInfoIsExisted`。邀请人信息已存在，不可重复提交。
- `InvitationInfoIsNotExisted`。邀请人信息不存在。
